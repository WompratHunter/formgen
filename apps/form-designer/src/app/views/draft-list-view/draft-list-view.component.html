<div class="list-container" [fgLoadingBar]="loading()">
  <div class="list-header">
    <h1>My Drafts</h1>
  </div>

  @if (!loading() && !drafts().length) {
    <fg-empty-state
      icon="description"
      heading="No drafts yet"
      body="Generate your first form from a plain-English description."
      ctaLabel="New Form"
      ctaRoute="/prompt"
    />
  } @else if (!loading()) {
    <div class="draft-list">
      @for (draft of drafts(); track draft.id) {
        <mat-card class="draft-card">
          <mat-card-header>
            <mat-card-title>{{ draft.name }}</mat-card-title>
            <mat-card-subtitle>
              {{ formatDate(draft.updated_at) }} Â· v{{ draft.version }}
            </mat-card-subtitle>
          </mat-card-header>

          @if (draft.description) {
            <mat-card-content>
              <p class="draft-description">{{ draft.description }}</p>
            </mat-card-content>
          }

          <mat-card-actions>
            <fg-status-chip [status]="draft.status" />
            <span class="actions-spacer"></span>
            <a
              mat-button
              [routerLink]="['/drafts', draft.id]"
              [attr.aria-label]="'Edit ' + draft.name"
            >Edit</a>
            <button
              mat-button
              color="warn"
              [disabled]="deletingId() === draft.id"
              [attr.aria-label]="deletingId() === draft.id ? 'Deleting ' + draft.name : 'Delete ' + draft.name"
              (click)="delete(draft.id)"
            >Delete</button>
          </mat-card-actions>

          @if (deletingId() === draft.id) {
            <mat-progress-bar mode="indeterminate" aria-label="Deleting draft" />
          }
        </mat-card>
      }
    </div>
  }
</div>

<a
  mat-fab
  extended
  routerLink="/prompt"
  class="new-form-fab"
  aria-label="New Form"
>
  <mat-icon>add</mat-icon>
  New Form
</a>
